# 📦 port-checker
## main

### PCAP Port Analysis Tool

This script analyzes PCAP files to extract and count destination TCP and UDP ports per device.  
It outputs a JSON report with the results.

---

## 📁 Directory Structure Required

Before running the script, structure your main directory as follows:

```
main_pcap_folder/
│
├── pcap1/
│   ├── name.txt      # contains the name of the device (e.g., Laptop_Office)
|   ├── mac.txt       # contains the mac of the device (e.g, cc:8d:a2:a0:09:78)
│   └── *.pcap        # one or more PCAP files to analyze
│
├── pcap2/
│   ├── name.txt
|   ├── mac.txt       
│   └── *.pcap
│
...
```

Each subfolder must be named with the prefix `pcap` followed by a number (e.g., `pcap1`, `pcap2`, ...).

- `mac.txt`: contains the mac of the device.
- `name.txt`: contains a readable name for the device.
- One or more `.pcap` files must be present for analysis.

---

## 🛠️ Requirements

- Python 3.x
- **TShark** (part of Wireshark) installed and accessible via command line.

### Install TShark

<details>
<summary>Ubuntu/Debian</summary>

```bash
sudo apt install tshark
```
</details>

<details>
<summary>macOS (with Homebrew)</summary>

```bash
brew install wireshark
```
</details>

<details>
<summary>Windows</summary>

Download and install Wireshark from [https://www.wireshark.org/](https://www.wireshark.org/)  
Make sure **TShark** is added to your system's PATH.
</details>

---

## ▶️ How to Run the Script

1. Place the script in a folder of your choice together with find_ip.py, which finds the IP by analyzing communications between the device and the DHCP server.
2. Open a terminal or command prompt.
3. Run the script:

   ```bash
   python3 main.py
   ```

4. When prompted, enter the full path to your main directory:

   ```
   Enter the path of the main directory: /home/YOUR_USER/pcap_folder
   ```

---

## 📤 Output

After execution, a new folder named `log` will be created inside your main directory.  
It will contain one JSON file for each device analyzed:

```
main_pcap_folder/
├── log/
│   ├── port_analysis_1.json
│   ├── port_analysis_2.json
│   ...
```

Each JSON file includes:

- Device name and local IP
- Total number of different TCP/UDP ports found
- Ports used only once
- Full list of ports sorted by frequency

---

## 📝 Notes

- Private/internal IP addresses (e.g., `192.168.x.x`, `10.x.x.x`) are excluded from the analysis.
- Only:
  - **TCP packets** with the **SYN** flag and **no ACK** (new connections)
  - **All UDP packets**
  - **Packets** with the **mac ** as **source**
  are considered.
## visualize_port

## 📊 Port Usage Visualization
Graphical Analysis of Contacted TCP/UDP Ports
Once the PCAP files have been analyzed and the JSON reports have been generated, you can visualize the data using the provided plotting script.
This helps to better understand how many ports each device contacts, how many of them are single-use, and provides percentage-based insights.

## 📁 Input Directory
Before running the visualization script, make sure the log folder containing the JSON output files is present:

main_pcap_folder/
├── log/
│   ├── port_analysis_1.json
│   ├── port_analysis_2.json
│   ...
Each JSON file must follow the format generated by the analysis script (see previous section).

## ▶️ How to Run the Visualization Script
Ensure matplotlib and numpy are installed:

pip install matplotlib numpy
Run the plotting script:

python3 plot_ports.py
When prompted (or directly within the script), ensure the path to the log folder is correctly set.
The script reads all .json files inside that folder.

## 🖼️ Output
The script will generate one horizontal bar chart per protocol (TCP and UDP) and save them in a new plots/ folder:

main_pcap_folder/
├── plots/
│   ├── grafico_porte_TCP.png
│   ├── grafico_porte_UDP.png
Each plot shows:

Total contacted ports per device

Ports contacted only once

The percentage of single-use ports

A vertical dashed line showing the average number of contacted ports

These visualizations are useful for spotting anomalies, comparing device behavior, and tracking changes over time.
